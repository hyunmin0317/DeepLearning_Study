# chap 08-2 풀링 연산에 대해 알아봅니다

2021.03.31

`합성곱 신경망에서는 합성곱이 일어나는 층을 합성곱층, 풀링이 일어나는 층을 풀링층이라고 부르며 합성곱층과 풀링층에서 만들어진 결과를 특성 맵(feature map)이라고 부릅니다.`

* RGB 컬러 채널을 가진 입력 이미지가 합성곱층과 풀링층을 거치면서 변환되는 과정, 특성 맵을 스캔하며 최댓값을 고르는 모습

  <img src="https://github.com/hyunmin0317/DeepLearning_Study/blob/master/chap08/section2/image01.PNG?raw=true" alt="image01" style="zoom: 67%;" />
  
  * 합성곱 신경망의 전형적인 과정
    1. 입력이 합성곱층을 통과할 때 합성곱과 활성화 함수가 적용되어 특성 맵이 만들어짐
    2. 특성 맵이 풀링층을 통과하여 또 다른 특성 맵이 만들어짐
  * 풀링: 특성 맵을 스캔하며 최댓값을 고르거나 평균값을 계산하는 과정

<br>

### 01. 최대 풀링에 대해 알아봅니다

* 최댓값을 고르는 방식을 최대 풀링(max pooling)이라고 하며 특성 맵 위를 스캔하며 최댓값을 고름
* 풀링 영역의 크기는 보통 2 * 2를 지정하고 일반적으로 스트라이드는 풀링의 한 모서리 크기로 지정함

<br>

### 02. 평균 풀링에 대해 알아봅니다

* 평균 풀링(average pooling)은 풀링 영역의 평균값을 계산함
* 평균 풀링은 합성곱층을 통과하는 특징들을 희석시킬 가능성이 높기 때문에 연구자들은 최대 풀링을 더 선호함

<br>

### 03. 최대 풀링과 평균 풀링을 수행합니다

* 텐서플로의 max_pool2d() 함수를 사용하여 최대 풀링을 수행

* 1~16의 값이 들어있는 4 * 4 크기의 배열을 만든 다음 1 * 4 * 4 * 1 크기의 배열로 변형

  ```python
  x = np.array([[1, 2, 3, 4],
                [5, 6, 7, 8],
                [9, 10, 11, 12],
                [13, 14, 15, 16]])
  x = x.reshape(1, 4, 4, 1)
  ```

* max_pool2d() 함수가 반환한 Tensor 객체를 numpy() 메서드로 변환한 다음 2 * 2 크기의 2차원 배열로 변형

  ```python
  p_out = tf.nn.max_pool2d(x, ksize=2, strides=2, padding='VALID')
  p_out.numpy().reshape(2, 2)
  # array([[ 6.,  8.],
  #        [14., 16.]], dtype=float32)
  ```

* 풀링층에는 학습되는 가중치가 없음 

* 풀링은 배치 차원이나 채널 차원으로 적용되지 않으므로 풀링층을 통과하기 전후로 배치 크기와 채널 크기가 동일함